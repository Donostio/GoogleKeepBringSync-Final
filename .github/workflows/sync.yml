name: Google Keep <> Bring Sync

on:
  schedule:
    - cron: '0 */59 * * *'
  
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    container: python:3.10-slim
    
    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup and Run
        env:
          GOOGLE_EMAIL: ${{ secrets.GOOGLE_EMAIL }}
          KEEP_LIST_ID: ${{ secrets.KEEP_LIST_ID }}
          BRING_EMAIL: ${{ secrets.BRING_EMAIL }}
          BRING_PASSWORD: ${{ secrets.BRING_PASSWORD }}
          SYNC_MODE: 0
          BRING_LIST_UUID: ${{ secrets.BRING_LIST_UUID }}
          GOOGLE_TOKEN: ${{ secrets.GOOGLE_TOKEN }}
        run: |
          # Install ALL dependencies from requirements.txt
          pip install -r requirements.txt
          
          # Handle the token file setup
          echo "$GOOGLE_TOKEN" > token.txt
          
          # Execute the script
          python sync_keep_bring.py
